<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘å†…å®¹åˆ†æä¸ä¸“å®¶è§‚ç‚¹ç”Ÿæˆå·¥å…·</title>
    <style>
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            list-style: none;
            margin-bottom: 20px;
        }

        .navbar .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .navbar li:not(.logo) {
            margin-left: 20px;
        }

        .navbar a {
            text-decoration: none;
            color: #333;
            font-size: 16px;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .navbar a:hover {
            background: #667eea;
            color: white;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        input[type="text"],
        input[type="password"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            background: #f0f4ff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            background: #e8edff;
            border-color: #764ba2;
        }

        .file-upload.dragover {
            background: #d6e0ff;
            border-color: #764ba2;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status.show {
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .keywords-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .keyword-tag {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .file-list {
            margin-top: 15px;
        }

        .file-item {
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            flex: 1;
            color: #333;
        }

        .file-status {
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <nav>
        <ul class="navbar">
            <li class="logo">
                <a href="home.html">
                    <span class="logo-text">ğŸ“¹ è§†é¢‘å†…å®¹åˆ†æå·¥å…·</span>
                </a>
            </li>
            <li><a href="index.html">Video Content Analysis</a></li>
            <li><a href="index2.html">Expert Opinion Generation (RAG)</a></li>
        </ul>
    </nav>
    
    <div class="container">
        <h1>è§†é¢‘å†…å®¹åˆ†æä¸ä¸“å®¶è§‚ç‚¹ç”Ÿæˆå·¥å…·</h1>
        <p class="subtitle">æ”¯æŒè§†é¢‘é“¾æ¥åˆ†æã€æ‰¹é‡ä¸Šä¼ è§†é¢‘ï¼Œè‡ªåŠ¨æå–å­—å¹•ï¼Œç”Ÿæˆå…³é”®è¯ã€æ‘˜è¦å’Œä¸“å®¶è§‚ç‚¹æ–‡ç« </p>

        <div class="section" style="background: #fff3cd; border-left-color: #ffc107;">
            <div class="section-title">å…¨å±€é…ç½®:API Keysï¼ˆå¿…é¡»é…ç½®ï¼‰</div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div class="form-group">
                    <label>OpenAI API Key (ç”¨äºChatGPT):</label>
                    <input type="password" id="globalOpenAIKey" placeholder="sk-..." style="background: white;" required>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        ç”¨äºChatGPTæ¨¡å‹ï¼ˆå…³é”®è¯æå–ã€ä¸“å®¶è§‚ç‚¹ã€æ‘˜è¦ç”Ÿæˆï¼‰
                    </small>
                </div>

                <div class="form-group">
                    <label>Gemini API Key (ç”¨äºGemini):</label>
                    <input type="password" id="globalGeminiKey" placeholder="Google API Key" style="background: white;" required>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        ç”¨äºGeminiæ¨¡å‹ï¼ˆè§†é¢‘åˆ†æã€å…³é”®è¯æå–ã€ä¸“å®¶è§‚ç‚¹ï¼‰
                    </small>
                </div>

                <div class="form-group">
                    <label>DeepSeek API Key (ç”¨äºDeepSeek):</label>
                    <input type="password" id="globalDeepSeekKey" placeholder="DeepSeek API Key" style="background: white;">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        ç”¨äºDeepSeekæ¨¡å‹ï¼ˆå…³é”®è¯æå–ã€ä¸“å®¶è§‚ç‚¹ã€æ‘˜è¦ç”Ÿæˆï¼Œå¯é€‰ï¼‰
                    </small>
                </div>

                <div class="form-group">
                    <label>Qwen API Key (ç”¨äºé˜¿é‡Œäº‘ç™¾ç‚¼):</label>
                    <input type="password" id="globalQwenKey" placeholder="sk-..." style="background: white;">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        ç”¨äºQwenæ¨¡å‹ï¼ˆå…³é”®è¯æå–ã€ä¸“å®¶è§‚ç‚¹ã€æ‘˜è¦ç”Ÿæˆï¼Œå¯é€‰ï¼‰
                    </small>
                </div>
            </div>
            
            <small style="color: #856404; display: block; margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px;">
                <strong>æç¤ºï¼š</strong>é…ç½®å¥½API Keysåï¼Œåç»­æ‰€æœ‰æ­¥éª¤ä¼šè‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„Keyï¼Œæ— éœ€é‡å¤è¾“å…¥ã€‚
            </small>
        </div>

        <div class="section">
            <div class="section-title"> è§†é¢‘è¾“å…¥ + Few-Shoté…ç½®</div>
            
            <div style="margin-bottom: 30px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #e0e0e0;">
                <h3 style="color: #667eea; margin-bottom: 15px; font-size: 18px;">æ–¹å¼ä¸€ï¼šè§†é¢‘é“¾æ¥åˆ†æ</h3>
                
                <div class="form-group">
                    <label>è§†é¢‘é“¾æ¥æˆ–ç›¸å…³ç½‘ç«™é“¾æ¥:</label>
                    <input type="text" id="videoUrl" placeholder="ç²˜è´´è§†é¢‘URLæˆ–åŒ…å«è§†é¢‘çš„ç½‘é¡µé“¾æ¥ï¼Œä¾‹å¦‚: https://example.com/video.mp4">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        æ”¯æŒç›´æ¥è§†é¢‘é“¾æ¥ï¼ˆ.mp4ç­‰ï¼‰æˆ–åŒ…å«è§†é¢‘çš„ç½‘é¡µé“¾æ¥
                    </small>
                </div>

                <div class="form-group">
                    <label>é€‰æ‹©AIæ¨¡å‹:</label>
                    <select id="aiModel" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                        <option value="gemini">Gemini 2.5 Proï¼ˆæ”¯æŒè§†é¢‘åˆ†æï¼Œæ¨èï¼‰</option>
                        <option value="chatgpt">ChatGPT 5.2ï¼ˆåŸºäºè½¬å½•æ–‡æœ¬ï¼‰</option>
                        <option value="deepseek">DeepSeek Chatï¼ˆåŸºäºè½¬å½•æ–‡æœ¬ï¼‰</option>
                        <option value="qwen">Qwen Maxï¼ˆåŸºäºè½¬å½•æ–‡æœ¬ï¼‰</option>
                    </select>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        Geminiå¯ä»¥ç›´æ¥åˆ†æè§†é¢‘å†…å®¹ï¼›ChatGPT/DeepSeek/Qwenä¼šå…ˆä¸‹è½½è§†é¢‘å¹¶ç”¨Whisperè½¬å½•ï¼Œç„¶åæå–å…³é”®è¯
                    </small>
                </div>

                <div style="text-align: center; margin: 30px 0; position: relative;">
                    <div style="position: absolute; left: 0; right: 0; top: 50%; height: 1px; background: #e0e0e0;"></div>
                    <span style="background: #f8f9fa; padding: 0 20px; color: #999; position: relative;">æˆ–</span>
                </div>
            </div>
            
            <div style="padding: 20px; background: white; border-radius: 8px; border: 2px solid #e0e0e0;">
                <h3 style="color: #667eea; margin-bottom: 15px; font-size: 18px;">æ–¹å¼äºŒï¼šä¸Šä¼ è§†é¢‘æ–‡ä»¶å¹¶æå–å­—å¹•</h3>
                
                <div class="form-group">
                    <div class="file-upload" id="fileUpload">
                        <p>ç‚¹å‡»æˆ–æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„</p>
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">
                            æ”¯æŒæ ¼å¼: MP4, AVI, MOV, MKV, MP3, WAV ç­‰
                        </p>
                        <input type="file" id="fileInput" multiple accept="video/*,audio/*">
                    </div>
                </div>

                <div class="file-list" id="fileList"></div>

                <div class="status" id="transcribeStatus"></div>
                <div class="loading" id="transcribeLoading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨è½¬å½•éŸ³é¢‘ï¼Œè¯·ç¨å€™...</p>
                </div>
            </div>
            
            <!-- Few-Shoté…ç½® -->
            <div class="section-title" style="margin-top: 30px;">Few-Shoté…ç½®</div>
            <div style="margin-top: 20px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #e0e0e0;">
                <h3 style="color: #667eea; margin-bottom: 15px; font-size: 18px;">Few-Shotç¤ºä¾‹é…ç½®ï¼ˆè®©AIå­¦ä¹ è¯­è¨€å’Œæ ¼å¼ï¼‰</h3>
                
                <div class="form-group">
                    <label>æ ‡é¢˜:</label>
                    <input type="text" id="title" placeholder="è§†é¢‘æ ‡é¢˜">
                </div>

                <div class="form-group">
                    <label>æŠ¥å‘Šäºº:</label>
                    <input type="text" id="speakerName" placeholder="æŠ¥å‘Šäººå§“å">
                </div>

                <div class="form-group">
                    <label>åŸæ‘˜è¦/æè¿°:</label>
                    <textarea id="originalAbstract" placeholder="è¾“å…¥åŸå§‹æ‘˜è¦æˆ–æè¿°ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>

                <div class="form-group">
                    <label>Few-Shotç¤ºä¾‹æ–‡æœ¬:</label>
                    <textarea id="sharedFewShotText" placeholder="ç²˜è´´Few-Shotç¤ºä¾‹æ–‡æœ¬ï¼ŒAIå°†å­¦ä¹ è¿™ä¸ªç¤ºä¾‹çš„é£æ ¼å’Œæ ¼å¼..." style="min-height: 200px;">ã€èŒƒä¾‹é£æ ¼å‚è€ƒã€‘
æ ‡é¢˜ï¼šé˜¿ç§’å…‰ç§‘æŠ€å‰æ²¿
æŠ¥å‘Šäººï¼šé¾šæ——ç…Œ
è§‚ç‚¹æ‘˜è¦ï¼š
å…‰å­¦ä½œä¸ºç‰©ç†å­¦çš„é‡è¦åˆ†æ”¯ï¼Œå…¶å‘å±•å†ç¨‹è´¯ç©¿äº†äººç±»ç§‘å­¦æ¢ç´¢çš„å†å²ã€‚è¿‘æ—¥ï¼Œä¸­å›½ç§‘å­¦é™¢ç‰©ç†ç ”ç©¶æ‰€ç ”ç©¶å‘˜é­å¿—ä¹‰åœ¨"ç§‘å­¦ä¸æŠ€æœ¯å‰æ²¿è®ºå›"ä¸Šï¼Œæ·±å…¥å‰–æäº†ä»ç»å…¸å…‰å­¦åˆ°é˜¿ç§’å…‰ç§‘æŠ€çš„æ¼”è¿›è„‰ç»œåŠå…¶å¯¹ç§‘å­¦å‰æ²¿çš„æ·±è¿œå½±å“ã€‚

ä»ç»å…¸ç†è®ºåˆ°æ¿€å…‰é©å‘½
é­å¿—ä¹‰å›é¡¾äº†äººç±»å¯¹å…‰æœ¬è´¨çš„è®¤çŸ¥è¿‡ç¨‹ã€‚ä»æ¬§å‡ é‡Œå¾—çš„ã€Šåå°„å…‰å­¦ã€‹åˆ°19ä¸–çºªå…³äº"æ³¢ç²’äºŒè±¡æ€§"çš„ç™¾å¹´äº‰è®ºï¼Œç›´è‡³1865å¹´éº¦å…‹æ–¯éŸ¦æ–¹ç¨‹ç»„çš„æå‡ºï¼Œå…‰ã€ç”µã€ç£å¾—ä»¥ç»Ÿä¸€ï¼Œå¥ å®šäº†ç°ä»£å…‰å­¦çš„åŸºçŸ³ã€‚ä»–ç‰¹åˆ«æŒ‡å‡ºï¼Œ1960å¹´æ¢…æ›¼å‘æ˜ç¬¬ä¸€å°çº¢å®çŸ³æ¿€å…‰å™¨æ˜¯äººç±»å…‰å­¦å²ä¸Šçš„é‡Œç¨‹ç¢‘ï¼Œè¿™ç§å…·æœ‰é«˜å•è‰²æ€§ã€é«˜æ–¹å‘æ€§å’Œé«˜ç›¸å¹²æ€§çš„æ–°å‹å…‰æºï¼Œç›´æ¥å¼•å‘äº†ä¸€åœºç§‘æŠ€é©å‘½ï¼Œå¹¶å‚¬ç”Ÿäº†è¯ºè´å°”å¥–çº§çš„é‡å¤§å‘ç°ï¼Œå¦‚æ³½ç»´å°”æ•™æˆåˆ©ç”¨é£ç§’æ¿€å…‰ç ”ç©¶åŒ–å­¦ååº”åŠ¨åŠ›å­¦ã€‚

æŒ‘æˆ˜æ—¶é—´æé™ï¼šä»é£ç§’åˆ°é˜¿ç§’
æŠ¥å‘Šé‡ç‚¹é˜è¿°äº†æ¿€å…‰æŠ€æœ¯å‘æç«¯æ—¶é—´å°ºåº¦æ¨è¿›çš„çªç ´ã€‚é­å¿—ä¹‰æŒ‡å‡ºï¼Œä¸åŒçš„ç‰©ç†è¿‡ç¨‹å¯¹åº”ç€ä¸åŒçš„æ—¶é—´å°ºåº¦ï¼šèŠ¯ç‰‡æŒ‡ä»¤åœ¨çº³ç§’é‡çº§ï¼Œåˆ†å­ç”µç¦»åœ¨çš®ç§’é‡çº§ï¼Œè€ŒåŸå­å†…ç”µå­è¿åŠ¨å‘¨æœŸåˆ™çŸ­è‡³é˜¿ç§’ï¼ˆ10-18ç§’ï¼‰é‡çº§ã€‚ä¸ºäº†æ¢ç´¢å¾®è§‚ä¸–ç•Œçš„ç¬æ€è¿‡ç¨‹ï¼Œç§‘å­¦å®¶ä»¬é€šè¿‡è°ƒQæŠ€æœ¯å’Œé”æ¨¡æŠ€æœ¯ç›¸ç»§å®ç°äº†çº³ç§’å’Œçš®ç§’è„‰å†²ã€‚è€Œæ–°ä¸€ä»£çš„é«˜æ¬¡è°æ³¢æŠ€æœ¯ï¼Œæ›´æ˜¯æˆåŠŸå°†æ¿€å…‰è„‰å†²å®½åº¦æ¨è¿›åˆ°äº†é˜¿ç§’é¢†åŸŸã€‚

é˜¿ç§’ç§‘å­¦çš„æœªæ¥å±•æœ›
é­å¿—ä¹‰å¼ºè°ƒï¼Œé˜¿ç§’è„‰å†²çš„å‡ºç°æ ‡å¿—ç€äººç±»æŒæ¡äº†æ¢æµ‹ç”µå­è¿åŠ¨çš„"è¶…å¿«ç›¸æœº"ã€‚è¿™ä¸€å‰æ²¿æŠ€æœ¯ä¸ä»…ä¸ºç ”ç©¶åŸå­ã€åˆ†å­å†…éƒ¨çš„ç”µå­åŠ¨åŠ›å­¦è¿‡ç¨‹æä¾›äº†å‰æ‰€æœªæœ‰çš„å·¥å…·ï¼Œæ›´åœ¨é‡å­ä¿¡æ¯ã€ç”Ÿç‰©åŒ»å­¦æˆåƒåŠæ–°ææ–™ç ”å‘ç­‰é¢†åŸŸå±•ç°å‡ºå·¨å¤§çš„åº”ç”¨æ½œåŠ›ã€‚é˜¿ç§’å…‰ç§‘æŠ€çš„å‘å±•ï¼Œå°†æå¤§åœ°æ‹“å±•äººç±»è®¤çŸ¥çš„æ—¶ç©ºè¾¹ç•Œï¼Œæ¨åŠ¨åŸºç¡€ç§‘å­¦ç ”ç©¶è¿›å…¥ä¸€ä¸ªå…¨æ–°çš„å¾®è§‚åŠ¨æ€æ—¶ä»£ã€‚

å…·ä½“å†…å®¹ç½‘ç«™é“¾æ¥ï¼šhttps://academics.casad.cas.cn/zjgd/202409/t20240905_5030809.html</textarea>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        è¿™ä¸ªç¤ºä¾‹å°†æŒ‡å¯¼AIç”Ÿæˆç›¸åŒé£æ ¼å’Œæ ¼å¼çš„æ–‡ç« 
                    </small>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="processVideoUrl()" style="margin-top: 20px;">åˆ†æè§†é¢‘å†…å®¹</button>
            
            <div class="status" id="videoUrlStatus"></div>
            <div class="loading" id="videoUrlLoading">
                <div class="spinner"></div>
                <p>æ­£åœ¨å¤„ç†è§†é¢‘ï¼Œè¯·ç¨å€™ï¼ˆè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰...</p>
            </div>
        </div>
        
        <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
        <div id="resultsSection" style="display: none; margin-top: 30px;">
            <div class="section-title">åˆ†æç»“æœ</div>
            
            <!-- è½¬å½•æ–‡æœ¬ -->
            <div class="form-group">
                <label>è½¬å½•æ–‡æœ¬:</label>
                <textarea id="transcript" placeholder="è½¬å½•æ–‡æœ¬å°†è‡ªåŠ¨æ˜¾ç¤ºåœ¨è¿™é‡Œ" readonly style="background: #f8f9fa;"></textarea>
            </div>
            
            <!-- å…³é”®è¯ç»“æœ -->
            <div class="result-box" id="keywordsResult" style="display: none; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <strong>æå–çš„å…³é”®è¯:</strong>
                    <button class="btn btn-secondary" onclick="showRegenerateOptions()" style="margin: 0; padding: 6px 12px; font-size: 14px;">é‡æ–°ç”Ÿæˆ</button>
                </div>
                <div class="keywords-list" id="keywordsList"></div>
                <textarea id="keywordsText" style="margin-top: 15px; min-height: 60px;" readonly></textarea>
            </div>
            
            <!-- ä¸“å®¶è§‚ç‚¹ç»“æœ -->
            <div class="result-box" id="expertOpinionResult" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <strong>ç”Ÿæˆçš„ä¸“å®¶è§‚ç‚¹æ–‡ç« :</strong>
                    <button class="btn btn-secondary" onclick="showRegenerateOptions()" style="margin: 0; padding: 6px 12px; font-size: 14px;">é‡æ–°ç”Ÿæˆ</button>
                </div>
                <div id="expertOpinionResultContent" style="margin-top: 10px;"></div>
            </div>
            
            <div id="regenerateOptions" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                <h3 style="color: #667eea; margin-bottom: 15px; font-size: 18px;">ä½¿ç”¨ä¸åŒæ¨¡å‹é‡æ–°ç”Ÿæˆ</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label>å…³é”®è¯æå–æ–¹å¼:</label>
                        <select id="keywordMethod" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <option value="jieba">æœ¬åœ° Jieba åˆ†è¯ï¼ˆå…è´¹ï¼‰</option>
                            <option value="openai">OpenAI GPT</option>
                            <option value="gemini">Gemini 2.5 Pro</option>
                        </select>
                    </div>
                    <div>
                        <label>ä¸“å®¶è§‚ç‚¹AIæ¨¡å‹:</label>
                        <select id="expertOpinionModel" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                            <option value="chatgpt">ChatGPT 5.1</option>
                            <option value="gemini">Gemini 2.5 Pro</option>
                            <option value="deepseek">DeepSeek Chat</option>
                            <option value="qwen">Qwen Max</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-success" onclick="generateKeywordsAndExpertOpinion()">é‡æ–°ç”Ÿæˆå…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹</button>
                <button class="btn btn-secondary" onclick="hideRegenerateOptions()" style="margin-left: 10px;">å–æ¶ˆ</button>
            </div>
            
            <div class="status" id="keywordsStatus"></div>
            <div class="loading" id="keywordsLoading">
                <div class="spinner"></div>
                <p>æ­£åœ¨ç”Ÿæˆå…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹æ–‡ç« ...</p>
            </div>
        </div>
        
        <!-- è§†é¢‘é“¾æ¥åˆ†æç»“æœ -->
        <div class="result-box" id="videoUrlResult" style="display: none; margin-top: 20px;">
            <strong>åˆ†æç»“æœ:</strong>
            <div id="videoUrlResultContent" style="margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        let API_BASE = window.location.origin;
        const currentPort = window.location.port;
        if (currentPort === '5500' || currentPort === '' || window.location.protocol === 'file:') {
            API_BASE = 'http://localhost:5001';
            console.log('æ£€æµ‹åˆ°Live Serveræˆ–ç›´æ¥æ‰“å¼€æ–‡ä»¶ï¼ŒAPIè¯·æ±‚å°†å‘é€åˆ°:', API_BASE);
        }
        
        let currentTranscript = '';
        let currentKeywords = [];
        let currentWebText = '';
        
        function getGlobalApiKey(model) {
            let key = '';
            if (model === 'chatgpt' || model === 'openai') {
                key = document.getElementById('globalOpenAIKey').value.trim();
            } else if (model === 'gemini') {
                key = document.getElementById('globalGeminiKey').value.trim();
            } else if (model === 'deepseek') {
                key = document.getElementById('globalDeepSeekKey').value.trim();
            } else if (model === 'qwen') {
                key = document.getElementById('globalQwenKey').value.trim();
            }
            
            // è‡ªåŠ¨ä¿å­˜åˆ°localStorageï¼Œä¾›å…¶ä»–é¡µé¢ä½¿ç”¨
            if (key) {
                try {
                    if (model === 'chatgpt' || model === 'openai') {
                        localStorage.setItem('globalOpenAIKey', key);
                    } else if (model === 'gemini') {
                        localStorage.setItem('globalGeminiKey', key);
                    } else if (model === 'deepseek') {
                        localStorage.setItem('globalDeepSeekKey', key);
                    } else if (model === 'qwen') {
                        localStorage.setItem('globalQwenKey', key);
                    }
                } catch (e) {
                    console.log('æ— æ³•ä¿å­˜API Keyåˆ°localStorage:', e);
                }
            }
            
            return key;
        }
        
        // æ³¨æ„ï¼šé¡µé¢åˆ·æ–°åAPI Keyè¾“å…¥æ¡†é»˜è®¤ä¸ºç©ºç™½ï¼Œä¸ä»localStorageæ¢å¤
        // localStorageä¸­çš„å€¼ä»…ç”¨äºè·¨é¡µé¢ä¼ é€’ï¼ˆå¦‚index2.htmlä½¿ç”¨ï¼‰
        
        // ç›‘å¬API Keyè¾“å…¥æ¡†å˜åŒ–ï¼Œå®æ—¶ä¿å­˜åˆ°localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const geminiInput = document.getElementById('globalGeminiKey');
            const openaiInput = document.getElementById('globalOpenAIKey');
            const deepseekInput = document.getElementById('globalDeepSeekKey');
            const qwenInput = document.getElementById('globalQwenKey');
            
            if (geminiInput) {
                geminiInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('globalGeminiKey', this.value.trim());
                    } catch (e) {
                        console.log('æ— æ³•ä¿å­˜Gemini API Key:', e);
                    }
                });
            }
            
            if (openaiInput) {
                openaiInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('globalOpenAIKey', this.value.trim());
                    } catch (e) {
                        console.log('æ— æ³•ä¿å­˜OpenAI API Key:', e);
                    }
                });
            }
            
            if (deepseekInput) {
                deepseekInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('globalDeepSeekKey', this.value.trim());
                    } catch (e) {
                        console.log('æ— æ³•ä¿å­˜DeepSeek API Key:', e);
                    }
                });
            }
            
            if (qwenInput) {
                qwenInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('globalQwenKey', this.value.trim());
                    } catch (e) {
                        console.log('æ— æ³•ä¿å­˜Qwen API Key:', e);
                    }
                });
            }
        });

        // ç›‘å¬API Keyè¾“å…¥æ¡†å˜åŒ–ï¼Œå®æ—¶ä¿å­˜åˆ°localStorageï¼ˆä¾›å…¶ä»–é¡µé¢ä½¿ç”¨ï¼Œå¦‚index2.htmlï¼‰
        // æ³¨æ„ï¼šé¡µé¢åˆ·æ–°åAPI Keyè¾“å…¥æ¡†é»˜è®¤ä¸ºç©ºç™½ï¼Œä¸ä»localStorageæ¢å¤
        document.addEventListener('DOMContentLoaded', function() {
            const geminiInput = document.getElementById('globalGeminiKey');
            const openaiInput = document.getElementById('globalOpenAIKey');
            const deepseekInput = document.getElementById('globalDeepSeekKey');
            const qwenInput = document.getElementById('globalQwenKey');
            
            if (geminiInput) {
                geminiInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('globalGeminiKey', this.value.trim());
                    } catch (e) {
                        console.log('æ— æ³•ä¿å­˜Gemini API Key:', e);
                    }
                });
            }
            
            if (openaiInput) {
                openaiInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('globalOpenAIKey', this.value.trim());
                    } catch (e) {
                        console.log('æ— æ³•ä¿å­˜OpenAI API Key:', e);
                    }
                });
            }
            
            if (deepseekInput) {
                deepseekInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('globalDeepSeekKey', this.value.trim());
                    } catch (e) {
                        console.log('æ— æ³•ä¿å­˜DeepSeek API Key:', e);
                    }
                });
            }
            
            if (qwenInput) {
                qwenInput.addEventListener('input', function() {
                    try {
                        localStorage.setItem('globalQwenKey', this.value.trim());
                    } catch (e) {
                        console.log('æ— æ³•ä¿å­˜Qwen API Key:', e);
                    }
                });
            }
        });

        const fileUpload = document.getElementById('fileUpload');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');

        fileUpload.addEventListener('click', () => fileInput.click());
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.classList.add('dragover');
        });
        fileUpload.addEventListener('dragleave', () => {
            fileUpload.classList.remove('dragover');
        });
        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                uploadAndTranscribe(file);
            });
        }

        function uploadAndTranscribe(file) {
            const formData = new FormData();
            formData.append('file', file);

            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <span class="file-name">${file.name}</span>
                <span class="file-status">å¤„ç†ä¸­...</span>
            `;
            fileList.appendChild(fileItem);

            showStatus('transcribeStatus', 'æ­£åœ¨ä¸Šä¼ å¹¶è½¬å½•éŸ³é¢‘...', 'info');

            fetch(`${API_BASE}/api/transcribe`, {
                method: 'POST',
                body: formData
            })
            .then(async response => {
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`æœåŠ¡å™¨é”™è¯¯ (${response.status}): ${errorText || response.statusText}`);
                }
                
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`æœåŠ¡å™¨è¿”å›é JSON å“åº”: ${text.substring(0, 200)}`);
                }
                
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    fileItem.querySelector('.file-status').textContent = 'âœ“ å®Œæˆ';
                    fileItem.querySelector('.file-status').style.color = '#28a745';
                    
                    currentTranscript = data.transcript;
                    document.getElementById('transcript').value = data.transcript;
                    
                    cleanTranscript(data.transcript, file.name);
                    
                    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                    document.getElementById('resultsSection').style.display = 'block';
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰Few-Shotæ–‡æœ¬ï¼Œå¦‚æœæœ‰åˆ™è‡ªåŠ¨ç”Ÿæˆå…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹
                    const fewShotText = document.getElementById('sharedFewShotText').value.trim();
                    if (fewShotText) {
                        showStatus('transcribeStatus', 'è½¬å½•å®Œæˆï¼æ­£åœ¨è‡ªåŠ¨ç”Ÿæˆå…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹...', 'info');
                        autoGenerateKeywordsAndExpertOpinion(data.transcript);
                    } else {
                        showStatus('transcribeStatus', 'è½¬å½•å®Œæˆï¼è¯·é…ç½®Few-Shotç¤ºä¾‹æ–‡æœ¬ä»¥ç”Ÿæˆå…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹ã€‚', 'success');
                    }
                } else {
                    fileItem.querySelector('.file-status').textContent = 'âœ— å¤±è´¥';
                    fileItem.querySelector('.file-status').style.color = '#dc3545';
                    showStatus('transcribeStatus', data.error || 'è½¬å½•å¤±è´¥', 'error');
                }
            })
            .catch(error => {
                fileItem.querySelector('.file-status').textContent = 'âœ— é”™è¯¯';
                fileItem.querySelector('.file-status').style.color = '#dc3545';
                console.error('ä¸Šä¼ é”™è¯¯è¯¦æƒ…:', error);
                showStatus('transcribeStatus', 'ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
            });
        }

        function cleanTranscript(transcript, filename) {
            fetch(`${API_BASE}/api/clean-transcript`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    transcript: transcript,
                    filename: filename
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentTranscript = data.cleaned_transcript;
                    document.getElementById('transcript').value = data.cleaned_transcript;
                }
            })
            .catch(error => {
                console.error('æ¸…æ´—å¤±è´¥:', error);
            });
        }

        function showStatus(id, message, type) {
            const status = document.getElementById(id);
            status.textContent = message;
            status.className = `status ${type} show`;
        }

        function hideStatus(id) {
            document.getElementById(id).classList.remove('show');
        }

        function showLoading(id, show) {
            document.getElementById(id).classList.toggle('show', show);
        }

        function processVideoUrl() {
            const videoUrl = document.getElementById('videoUrl').value.trim();
            const aiModel = document.getElementById('aiModel').value;
            const apiKey = getGlobalApiKey(aiModel);
            const fewShotText = document.getElementById('sharedFewShotText').value.trim();
            const title = document.getElementById('title').value.trim();
            const speakerName = document.getElementById('speakerName').value.trim();

            if (!videoUrl) {
                showStatus('videoUrlStatus', 'è¯·è¾“å…¥è§†é¢‘é“¾æ¥', 'error');
                return;
            }

            if (!apiKey) {
                const modelName = aiModel === 'chatgpt' ? 'OpenAI' : 
                                 (aiModel === 'gemini' ? 'Gemini' : 
                                 (aiModel === 'deepseek' ? 'DeepSeek' : 'Qwen'));
                showStatus('videoUrlStatus', `è¯·åœ¨å…¨å±€é…ç½®ä¸­è¾“å…¥${modelName} API Key`, 'error');
                return;
            }

            showLoading('videoUrlLoading', true);
            hideStatus('videoUrlStatus');
            document.getElementById('videoUrlResult').style.display = 'none';

            fetch(`${API_BASE}/api/process-video-url`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    video_url: videoUrl,
                    ai_model: aiModel,
                    api_key: apiKey,
                    few_shot_text: fewShotText,
                    title: title,
                    speaker_name: speakerName
                })
            })
            .then(async response => {
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`æœåŠ¡å™¨é”™è¯¯ (${response.status}): ${errorText || response.statusText}`);
                }
                
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`æœåŠ¡å™¨è¿”å›é JSON å“åº”: ${text.substring(0, 200)}`);
                }
                
                return response.json();
            })
            .then(data => {
                showLoading('videoUrlLoading', false);
                if (data.success) {
                    if (data.transcript) {
                        document.getElementById('transcript').value = data.transcript;
                        currentTranscript = data.transcript;
                    }
                    
                    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                    document.getElementById('resultsSection').style.display = 'block';
                    
                    // æ£€æŸ¥æ˜¯å¦å·²ç”Ÿæˆå…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹
                    const hasKeywords = data.keywords && data.keywords.length > 0;
                    const hasExpertOpinion = data.expert_opinion && Object.keys(data.expert_opinion).length > 0;
                    
                    if (hasKeywords) {
                        displayKeywords(data.keywords, data.keywords_str || '');
                    }
                    
                    if (data.web_text) {
                        document.getElementById('originalAbstract').value = data.web_text;
                        currentWebText = data.web_text;
                    }
                    
                    if (hasExpertOpinion) {
                        displayExpertOpinionResult(data.expert_opinion, 'expertOpinionResultContent', 'expertOpinionResult');
                    }
                    
                    const statusMsg = hasKeywords && hasExpertOpinion 
                        ? 'è§†é¢‘åˆ†æå®Œæˆï¼å·²ç”Ÿæˆè½¬å½•æ–‡æœ¬ã€å…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹ã€‚' 
                        : hasKeywords
                        ? 'è§†é¢‘åˆ†æå®Œæˆï¼å·²ç”Ÿæˆè½¬å½•æ–‡æœ¬å’Œå…³é”®è¯ã€‚'
                        : 'è§†é¢‘åˆ†æå®Œæˆï¼å·²ç”Ÿæˆè½¬å½•æ–‡æœ¬ã€‚';
                    showStatus('videoUrlStatus', statusMsg, 'success');
                } else {
                    showStatus('videoUrlStatus', data.error || 'åˆ†æå¤±è´¥', 'error');
                    if (data.detail) {
                        console.error('è¯¦ç»†é”™è¯¯:', data.detail);
                    }
                }
            })
            .catch(error => {
                showLoading('videoUrlLoading', false);
                showStatus('videoUrlStatus', 'åˆ†æå¤±è´¥: ' + error.message, 'error');
                console.error('å¤„ç†è§†é¢‘é“¾æ¥é”™è¯¯:', error);
            });
        }

        function displayKeywords(keywords, keywordsStr) {
            const keywordsList = document.getElementById('keywordsList');
            keywordsList.innerHTML = '';
            
            keywords.forEach(keyword => {
                const tag = document.createElement('span');
                tag.className = 'keyword-tag';
                tag.textContent = keyword;
                keywordsList.appendChild(tag);
            });

            document.getElementById('keywordsText').value = keywordsStr;
            document.getElementById('keywordsResult').style.display = 'block';
            currentKeywords = keywords;
        }

        function autoGenerateKeywordsAndExpertOpinion(transcript) {
            const originalAbstract = document.getElementById('originalAbstract').value.trim();
            const fewShotText = document.getElementById('sharedFewShotText').value.trim();
            const title = document.getElementById('title').value.trim();
            const speakerName = document.getElementById('speakerName').value.trim();
            
            if (!fewShotText) {
                return;
            }
            
            // ä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼šJiebaæå–å…³é”®è¯ï¼ŒChatGPTç”Ÿæˆä¸“å®¶è§‚ç‚¹
            const keywordMethod = 'jieba';
            const expertOpinionModel = 'chatgpt';
            const expertOpinionApiKey = getGlobalApiKey(expertOpinionModel);
            
            if (!expertOpinionApiKey) {
                showStatus('keywordsStatus', 'è¯·åœ¨å…¨å±€é…ç½®ä¸­è¾“å…¥OpenAI API Keyä»¥ç”Ÿæˆä¸“å®¶è§‚ç‚¹', 'error');
                return;
            }
            
            showLoading('keywordsLoading', true);
            hideStatus('keywordsStatus');
            
            // å…ˆæå–å…³é”®è¯ï¼ˆä½¿ç”¨Jiebaï¼Œå…è´¹ï¼‰
            fetch(`${API_BASE}/api/extract-keywords`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    transcript: transcript,
                    description: originalAbstract,
                    api_key: '',
                    use_openai: false,
                    use_gemini: false
                })
            })
            .then(response => response.json())
            .then(keywordData => {
                if (keywordData.success) {
                    currentKeywords = keywordData.keywords || [];
                    displayKeywords(keywordData.keywords || [], keywordData.keywords_str || '');
                    
                    // ç„¶åç”Ÿæˆä¸“å®¶è§‚ç‚¹
                    return fetch(`${API_BASE}/api/generate-expert-opinion`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            transcript: transcript,
                            web_text: originalAbstract,
                            few_shot_text: fewShotText,
                            title: title,
                            speaker_name: speakerName,
                            ai_model: expertOpinionModel,
                            api_key: expertOpinionApiKey
                        })
                    });
                } else {
                    throw new Error(keywordData.error || 'å…³é”®è¯æå–å¤±è´¥');
                }
            })
            .then(response => response.json())
            .then(expertData => {
                showLoading('keywordsLoading', false);
                if (expertData.success) {
                    displayExpertOpinionResult(expertData.result, 'expertOpinionResultContent', 'expertOpinionResult');
                    showStatus('keywordsStatus', 'å…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹ç”ŸæˆæˆåŠŸï¼', 'success');
                    hideRegenerateOptions(); // ç”ŸæˆæˆåŠŸåéšè—é‡æ–°ç”Ÿæˆé€‰é¡¹
                } else {
                    showStatus('keywordsStatus', expertData.error || 'ä¸“å®¶è§‚ç‚¹ç”Ÿæˆå¤±è´¥', 'error');
                }
            })
            .catch(error => {
                showLoading('keywordsLoading', false);
                showStatus('keywordsStatus', 'ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
                console.error('è‡ªåŠ¨ç”Ÿæˆé”™è¯¯:', error);
            });
        }

        function displayExpertOpinionResult(result, resultContentId, resultContainerId) {
            const resultContent = document.getElementById(resultContentId);
            let html = '';

            if (result.comprehensive_summary) {
                html += `<div style="margin-bottom: 20px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">ä¸“å®¶è§‚ç‚¹æ–‡ç« </h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; white-space: pre-wrap; line-height: 1.6;">
                        ${result.comprehensive_summary.replace(/\n/g, '<br>')}
                    </div>
                </div>`;
            }

            if (result.visual_evidence && result.visual_evidence.details) {
                html += `<div style="margin-bottom: 20px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">è§†è§‰è¯æ®</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <p><strong>æè¿°:</strong> ${result.visual_evidence.description || 'æ— '}</p>
                        <ul style="margin-top: 10px;">`;
                if (result.visual_evidence.details && result.visual_evidence.details.length > 0) {
                    result.visual_evidence.details.forEach(detail => {
                        html += `<li><strong>${detail.timestamp || 'æœªçŸ¥æ—¶é—´'}:</strong> ${detail.content || ''}</li>`;
                    });
                }
                html += `</ul></div></div>`;
            }

            if (result.speaker_emphasis) {
                html += `<div style="margin-bottom: 20px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">æ¼”è®²è€…å¼ºè°ƒçš„é‡ç‚¹</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <p><strong>æè¿°:</strong> ${result.speaker_emphasis.description || 'æ— '}</p>`;
                if (result.speaker_emphasis.points && result.speaker_emphasis.points.length > 0) {
                    html += `<ul style="margin-top: 10px;">`;
                    result.speaker_emphasis.points.forEach(point => {
                        html += `<li>${point}</li>`;
                    });
                    html += `</ul>`;
                }
                html += `</div></div>`;
            }

            if (html === '') {
                html = '<p>ç»“æœæ ¼å¼å¼‚å¸¸ï¼ŒåŸå§‹æ•°æ®:</p><pre>' + JSON.stringify(result, null, 2) + '</pre>';
            }

            resultContent.innerHTML = html;
            document.getElementById(resultContainerId).style.display = 'block';
        }

        // åˆå¹¶çš„å…³é”®è¯æå–å’Œä¸“å®¶è§‚ç‚¹ç”Ÿæˆå‡½æ•°
        function generateKeywordsAndExpertOpinion() {
            const transcript = document.getElementById('transcript').value.trim();
            const originalAbstract = document.getElementById('originalAbstract').value.trim();
            const keywordMethod = document.getElementById('keywordMethod').value;
            const expertOpinionModel = document.getElementById('expertOpinionModel').value;
            const fewShotText = document.getElementById('sharedFewShotText').value.trim();
            const title = document.getElementById('title').value.trim();
            const speakerName = document.getElementById('speakerName').value.trim();

            if (!transcript && !originalAbstract) {
                showStatus('keywordsStatus', 'è¯·å…ˆä¸Šä¼ è§†é¢‘è¿›è¡Œè½¬å½•æˆ–è¾“å…¥åŸæ‘˜è¦', 'error');
                return;
            }

            if (!fewShotText) {
                showStatus('keywordsStatus', 'Few-Shotç¤ºä¾‹æ–‡æœ¬ä¸èƒ½ä¸ºç©º', 'error');
                return;
            }

            const keywordApiKey = keywordMethod !== 'jieba' ? getGlobalApiKey(keywordMethod) : '';
            const expertOpinionApiKey = getGlobalApiKey(expertOpinionModel);

            if (keywordMethod !== 'jieba' && !keywordApiKey) {
                const modelName = keywordMethod === 'openai' ? 'OpenAI' : 'Gemini';
                showStatus('keywordsStatus', `è¯·åœ¨å…¨å±€é…ç½®ä¸­è¾“å…¥${modelName} API Key`, 'error');
                return;
            }

            if (!expertOpinionApiKey) {
                const modelName = expertOpinionModel === 'chatgpt' ? 'OpenAI' : 
                                 (expertOpinionModel === 'gemini' ? 'Gemini' : 
                                 (expertOpinionModel === 'deepseek' ? 'DeepSeek' : 'Qwen'));
                showStatus('keywordsStatus', `è¯·åœ¨å…¨å±€é…ç½®ä¸­è¾“å…¥${modelName} API Key`, 'error');
                return;
            }

            showLoading('keywordsLoading', true);
            hideStatus('keywordsStatus');
            document.getElementById('keywordsResult').style.display = 'none';
            document.getElementById('expertOpinionResult').style.display = 'none';

            fetch(`${API_BASE}/api/extract-keywords`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    transcript: transcript,
                    description: originalAbstract,
                    api_key: keywordApiKey,
                    use_openai: keywordMethod === 'openai',
                    use_gemini: keywordMethod === 'gemini'
                })
            })
            .then(response => response.json())
            .then(keywordData => {
                if (keywordData.success) {
                    currentKeywords = keywordData.keywords || [];
                    displayKeywords(keywordData.keywords || [], keywordData.keywords_str || '');
                    
                    return fetch(`${API_BASE}/api/generate-expert-opinion`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            transcript: transcript,
                            web_text: originalAbstract,
                            few_shot_text: fewShotText,
                            title: title,
                            speaker_name: speakerName,
                            ai_model: expertOpinionModel,
                            api_key: expertOpinionApiKey
                        })
                    });
                } else {
                    throw new Error(keywordData.error || 'å…³é”®è¯æå–å¤±è´¥');
                }
            })
            .then(response => response.json())
            .then(expertData => {
                showLoading('keywordsLoading', false);
                if (expertData.success) {
                    displayExpertOpinionResult(expertData.result, 'expertOpinionResultContent', 'expertOpinionResult');
                    showStatus('keywordsStatus', 'å…³é”®è¯å’Œä¸“å®¶è§‚ç‚¹æ–‡ç« ç”ŸæˆæˆåŠŸï¼', 'success');
                    hideRegenerateOptions(); // ç”ŸæˆæˆåŠŸåéšè—é‡æ–°ç”Ÿæˆé€‰é¡¹
                } else {
                    showStatus('keywordsStatus', expertData.error || 'ä¸“å®¶è§‚ç‚¹ç”Ÿæˆå¤±è´¥', 'error');
                }
            })
            .catch(error => {
                showLoading('keywordsLoading', false);
                showStatus('keywordsStatus', 'ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
                console.error('ç”Ÿæˆé”™è¯¯:', error);
            });
        }
        
        function showRegenerateOptions() {
            document.getElementById('regenerateOptions').style.display = 'block';
        }
        
        function hideRegenerateOptions() {
            document.getElementById('regenerateOptions').style.display = 'none';
        }
    </script>
</body>
</html>
